/* ----- Arrowhead Activities ----- */
jQuery(document).ready(function(e){"use strict";e("#feedback").hide(),e("#processing").hide(),e("#response").hide(),e("body").on("hidden.bs.modal",".video-modal",function(){e(".video-modal").find("video").trigger("pause")}),e(".navbar-toggle").click(function(){e(this).toggleClass("open"),e(".side-collapse").toggleClass("show")});var t=e("[data-toggle=collapse-side]"),a=t.attr("data-target"),o=t.attr("data-target-2");t.click(function(){e(a).toggleClass("in"),e(o).toggleClass("out")}),e("body").on("click",".datepicker",function(){e(this).datepicker({showButtonPanel:!0,dateFormat:"mm/dd/yy",changeMonth:!0,changeYear:!0,showAnim:"slideDown"}),e(this).datepicker("show")}),e("input[list]").length>0&&document.querySelector("input[list]").addEventListener("input",function(t){var a=t.target,o=a.getAttribute("list"),i=document.querySelectorAll("#"+o+" option"),n=document.getElementById(a.id+"-hidden"),s=a.value;n.value=s;for(var r=0;r<i.length;r++){var u=i[r];if(1==u.getAttribute("data-onetime")?e(".oneTime .oneTimeCheck").prop("checked",!0):e(".oneTime .oneTimeCheck").prop("checked",!1),u.innerText===s){n.value=u.getAttribute("data-value");break}e(".oneTime .oneTimeCheck").prop("checked",!1)}}),e(function(){e('[data-toggle="tooltip"]').tooltip()}),e("body").on("click",".postLink",function(){var t=e(this).attr("href"),a=e(this).data("keys").split(","),o=e(this).data("values").split(","),i={};return e.each(a,function(e,t){i[a[e]]=o[e]}),e.redirect(t,i),!1}),e("body").on("click",".showPW",function(){var t=e(this).data("pw-field");"password"===e(t).attr("type")?e(t).attr("type","text"):e(t).attr("type","password")}),e("body").on("blur",".input-username",function(){var t=e(this).val();return e(this).closest(".feedback"),e.ajax({type:"POST",url:"/ajax/admin/checkUsername.php",data:"username="+t,dataType:"json"}).done(function(t){"yes"==t.output.usernameExists?(e("#username-exists").html(t.output.feedback),e("#username-exists").show("slow"),e("#register-submit").prop("disabled",!0)):(e("#username-exists").hide("slow"),e("#register-submit").prop("disabled",!1))}).fail(function(e,t,a){console.log(e.status),console.log(a)}),!1}),e("body").on("blur",".input-firstName, .input-lastName",function(){var t=e(this).parents(".registerForm"),a=e(t).find(".input-firstName").val(),o=e(t).find(".input-lastName").val(),i=e(t).find(".input-email").val();return a&&o&&e.ajax({type:"POST",url:"/ajax/admin/checkUserExist.php",data:"firstName="+a+"&lastName="+o+"&email="+i,dataType:"json"}).done(function(t){"yes"==t.output.userExists?(e("#name-exists").html(t.output.feedback),e("#name-exists").show("slow")):e("#name-exists").hide("slow")}).fail(function(e,t,a){console.log(e.status),console.log(a)}),!1}),e("#registerForm").validate({rules:{password:"required",password_repeat:{equalTo:"#password"}},submitHandler:function(t){var a=e(t).serialize();return e("#feedback").show(),e("#processing").show(),e.ajax({type:"POST",url:"/ajax/admin/register.php",data:a,dataType:"json"}).done(function(t){t.output.accountCreated?(e("#processing").hide(),e("#response").show().html(t.output.feedback),"true"==t.output.accountCreated?(t.output.redirect&&window.location.replace(t.output.redirect),t.output.updateString&&(e("#searchTable").append(t.output.updateString),e("#registerForm").trigger("reset"),e("#addUser").removeClass("show"))):console.log("FAILURE"),setTimeout(function(){e("#feedback").fadeOut()},2e3)):console.log("NO ACCOUNT")}).fail(function(){console.log("FAILURE 3")}),!1}}),e("body").on("click","#btnRegister",function(){e("#forgot").removeClass("show")}),e("#forgotForm").validate({rules:{usernameForgot:{required:function(t){return e("#emailForgot").is(":blank")}},emailForgot:{required:function(t){return e("#usernameForgot").is(":blank")}}},submitHandler:function(t){var a=e(t).serialize();return e("#feedback").show(),e("#processing").show(),e.ajax({type:"POST",url:"/ajax/admin/password.php",data:a,dataType:"json"}).done(function(t){t.output.feedback?(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.redirect?window.location.replace(t.output.redirect):console.log("FAILURE"),setTimeout(function(){e("#feedback").fadeOut()},2e3)):console.log("NO ACCOUNT")}).fail(function(){console.log("FAILURE 3")}),!1}}),e("body").on("click","#btnForgot",function(){e("#register").removeClass("show")}),e("#resetForm").validate({rules:{password:"required",password_repeat:{equalTo:"#password"}},submitHandler:function(t){var a=e(t).serialize();return e("#feedback").show(),e("#processing").show(),e.ajax({type:"POST",url:"/ajax/admin/password.php",data:a,dataType:"json"}).done(function(t){t.output.feedback?(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.redirect?window.location.replace(t.output.redirect):console.log("FAILURE"),setTimeout(function(){e("#feedback").fadeOut()},2e3)):console.log("NO ACCOUNT")}).fail(function(){console.log("FAILURE 3")}),!1}});var i="",n="";e(".require-one")[0]&&(i=e(".require-one"),n=e.map(i,function(t,a){return e(t).attr("name")}).join(" ")),e.validator.addMethod("require-one",function(t){return e(".require-one:checked").size()>0},"Please check at least one"),e.validator.setDefaults({debug:!0,groups:{checks:n},rules:{password_repeat:{equalTo:"#password"}},errorPlacement:function(e,t){"checkbox"==t.attr("type")?e.insertAfter(".checkbox-group"):"radio"==t.attr("type")?e.insertAfter(t.closest(".activity-signup-buttons")):e.insertAfter(t)},success:"valid"});var s=e(".adminForm");function r(e,t){"complete"==e.document.readyState&&(clearInterval(t),e.focus(),e.print(),e.close())}s.validate(),e("body").on("click",".adminForm .adminBtn",function(){if(s.valid()){e("#feedback").show(),e("#processing").show();var t=e(this).data("op"),a=e(this).closest(".adminForm"),o="op="+t+"&"+e(a).serialize();return e.ajax({type:"POST",url:"/ajax/admin/"+t+".php",data:o,dataType:"json"}).done(function(t){if(t.output.op){if("update"==t.output.op)e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.redirect?setTimeout(function(){e("#feedback").hide(),window.location.replace(t.output.redirect)},2e3):setTimeout(function(){e("#feedback").fadeOut()},2e3);else if("add"==t.output.op)e("#list-group-edit").append(t.output.updateString),e("#processing").hide(),e("#response").show().html(t.output.feedback),e(".add-form").trigger("reset"),e(".collapse-form").removeClass("show"),t.output.redirect?setTimeout(function(){window.location.replace(t.output.redirect)},2e3):setTimeout(function(){e("#feedback").fadeOut()},2e3);else if("delete"==t.output.op){e("#processing").hide(),e("#response").show().html(t.output.feedback);var a="#form-"+t.output.update;t.output.redirect?setTimeout(function(){window.location.replace(t.output.redirect)},2e3):e.when(e(a).animate({backgroundColor:"#fbc7c7"},"fast").animate({opacity:"hide"},"slow")).then(function(){e(a).remove(),e("#feedback").fadeOut()})}}else e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")}),!1}}),e("body").on("click",".printLink",function(){e("#feedback").show(),e("#processing").show();var t=e(this).data("camper")?e(this).data("camper"):"",a=e(this).data("bunk")?e(this).data("bunk"):"",o=e(this).data("week")?e(this).data("week"):"",i=e(this).data("activity")?e(this).data("activity"):"",n=e(this).data("signup")&&"no"==e(this).data("signup")?"false":"true",s=e(this).data("date")?e(this).data("date"):"";return e.ajax({type:"POST",url:"/ajax/report/print-schedule.php",data:"camper="+t+"&week="+o+"&bunk="+a+"&activity="+i+"&date="+s+"&signup="+n,dataType:"json"}).done(function(t){if(t.output){var a=window.open("","",""),o=!1;return navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(o=!0),a.document.write('<!doctype html><html><head><meta charset="utf-8">'),a.document.write(t.output.header),a.document.write("</head><body>"),o&&a.document.write('<div class="container"><div class="text-right"><a class="btn btn-primary btn-print" onclick="printPage()">Print Page</a></div></div>'),a.document.write(t.output.body),o&&a.document.write("<script>function printPage() { window.print(); window.close(); }</script>"),a.document.write("</body></html>"),a.document.close(),a.focus(),o||(a.print(),a.close()),e("#feedback").hide(),e("#processing").hide(),!0}e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")}),!1}),e("body").on("click","form.scheduleForm .activity-signup-buttons .schedule-button",function(){var t=e("form.scheduleForm"),a=e(this).parent(".schedule-item");if(e(this).parents(".activity-signup-buttons").children(".schedule-item").not(a).each(function(){e(this).children(".schedule-button").removeClass("active"),e(this).children(".schedule-radio").removeClass("active"),e(this).children(".schedule-radio").removeAttr("checked")}),e(this).data("onetime")){var o="."+e(this).data("onetime");e(o).not(a).each(function(){e(this).addClass("disabled"),e(this).children(".schedule-radio").prop("checked",!1),e(this).children(".schedule-radio").prop("disabled",!0),e(this).children(".schedule-button").addClass("disabled")})}else{var i=e(this).closest(".activity-signup-buttons"),n=[];0!==e(i).find(".onetime").length&&(e(i).find(".onetime .schedule-button").each(function(){var t=e(this).data("onetime");e(this).prop("checked",!1),-1===e.inArray(t,n)&&"yes"!==e(this).data("previous")&&n.push(t)}),0!==n.length?(n=function e(t){for(var a=-1,o=t?t.length:0,i=-1,n=[];++a<o;){var s=t[a];s&&(n[++i]=s)}return n}(n),e.each(n,function(a,o){var i="."+o,n=0;e(t).find(i+" .schedule-radio").each(function(){e(this).prop("checked")&&(n+=1)}),0===n&&(e(i).removeClass("disabled"),e(i).children(".schedule-button").removeClass("disabled"))})):console.log("array is empty"))}}),e("body").on("change","form.activity-admin .period-select",function(){var t=e(this).children("option:selected").val();e.ajax({type:"POST",url:"/ajax/admin/comparePeriodGroup.php",data:"period="+t,dataType:"json"}).done(function(t){if(t.output.groups){var a=t.output.groups.split(",");e("form.activity-admin .group-select").val(a)}t.output.days&&e.each(t.output.days,function(t,a){0===parseInt(a)?(e("form.activity-admin ."+t+" input").attr("disabled",!0),e("form.activity-admin ."+t+" input").prop("checked",!1),e("form.activity-admin ."+t).addClass("text-muted")):(e("form.activity-admin ."+t+" input").attr("disabled",!1),e("form.activity-admin ."+t).removeClass("text-muted"))})}).fail(function(){console.log("fail")})});var u=e(".scheduleForm");u.validate(),e("body").on("click",".scheduleForm .scheduleBtn",function(){if(u.valid()){e("#feedback").show(),e("#processing").show(),e(this).html("Schedule Complete").attr("disabled",!0);var t=e(this).data("op"),a=e(this).closest(".scheduleForm"),o="op="+t+"&"+e(a).serialize();return e.ajax({type:"POST",url:"/ajax/schedule/"+t+".php",data:o,dataType:"json"}).done(function(t){t.output.op?"update"==t.output.op?(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.redirect?setTimeout(function(){e("#feedback").hide(),window.location.replace(t.output.redirect)},2e3):setTimeout(function(){e("#feedback").fadeOut()},2e3)):"add"==t.output.op&&(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.redirect?setTimeout(function(){window.location.replace(t.output.redirect)},2e3):setTimeout(function(){e("#feedback").fadeOut()},2e3)):e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")}),!1}}),e("body").on("click",".submitLink",function(){return e(this).parent("form").submit(),!1}),e("body").on("click",".scroll-link",function(t){var a=e(this).attr("href");e("html,body").stop().animate({scrollTop:e(a).offset().top-50},1250,"easeInOutExpo"),t.preventDefault()}),e(".table-data-table").DataTable(),e(".dataTables_length").addClass("bs-select"),e("body").on("click",".btn-clear",function(){var t,a,o,i,n,s,r,u,d,c=e(this).data("funct");!confirm(e(this).data("alert"))||("clearBunks"===c?(t=this,e("#feedback").show(),e("#processing").show(),a=e(t).data("op"),e.ajax({type:"POST",url:"/ajax/bunks/"+a+".php",data:"op="+a,dataType:"json"}).done(function(t){t.output.op?(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.result,setTimeout(function(){e("#feedback").fadeOut()},2e3)):e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")})):"clearSchedule"===c?(o=this,e("#feedback").show(),e("#processing").show(),i=e(o).data("op"),n=e(o).data("user"),s=e(o).data("week"),r=e(o).data("activity"),e.ajax({type:"POST",url:"/ajax/schedule/"+i+".php",data:"user="+n+"&week="+s+"&activity="+r,dataType:"json"}).done(function(t){t.output.op?(e("#processing").hide(),e("#response").show().html(t.output.feedback),"success"==t.output.result?setTimeout(function(){e("#feedback").fadeOut(),t.output.info?(t.output.info.activity?e("#activity-signups").find("td").each(function(){e(this).html('<p class="text-muted"><em>No Signups Yet</em></p>')}):t.output.info.week&&e("#week-"+t.output.info.week).find(".period").each(function(){e(this).children("form").removeClass("scheduled-activity"),e(this).find("input.event").removeClass("btn-block btn-light-green d-block").addClass("btn-light").val("Click to Schedule Activities")}),setTimeout(function(){e("#feedback").fadeOut()},2e3)):window.location.reload()},2e3):setTimeout(function(){e("#feedback").fadeOut()},2e3)):e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")})):"clearSignups"!==c||(u=this,e("#feedback").show(),e("#processing").show(),d=e(u).data("op"),e.ajax({type:"POST",url:"/ajax/schedule/"+d+".php",data:"op="+d,dataType:"json"}).done(function(t){t.output.op?(e("#processing").hide(),e("#response").show().html(t.output.feedback),t.output.result,setTimeout(function(){e("#feedback").fadeOut()},2e3)):e("#response").html("No Output")}).fail(function(){e("#response").html("POST FAILED")})))})});